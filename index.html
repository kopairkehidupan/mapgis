
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Mini MapGIS</title>

  <!-- Leaflet 1.7.1 -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  <!-- Leaflet.draw 1.0.4 -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <!-- GIS libs -->
  <script src="https://unpkg.com/togeojson@0.16.0/togeojson.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://unpkg.com/tokml@0.4.0/tokml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  <link rel="stylesheet" href="style.css">

  <style>
    body,html{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif}
    #container{display:flex;height:100vh}
    #sidebar{width:350px;border-right:1px solid #ddd;padding:12px;box-sizing:border-box;overflow:auto;background:#fafafa}
    #map{flex:1}
    h3{margin:6px 0}
    input[type="file"]{width:100%}
    #fileList{
      list-style:none;
      padding:0;
      margin:6px 0;
      max-height: 520px;  /* ~5 cards × 104px per card */
      overflow-y: auto;
      overflow-x: hidden;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      background: #f9f9f9;
      padding: 4px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Custom Scrollbar untuk File List */
    #fileList::-webkit-scrollbar {
      width: 8px;
    }
    
    #fileList::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    #fileList::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    
    #fileList::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    .file-card{border:1px solid #e0e0e0;padding:8px;margin-bottom:8px;background:#fff;border-radius:6px}
    .file-header{display:flex;align-items:center;gap:8px}
    .file-title{flex:1;font-weight:600;cursor:pointer}
    .file-actions{display:flex;gap:6px}
    .btn-small{font-size:12px;padding:4px 6px;border-radius:4px;border:1px solid #bbb;background:#fff;cursor:pointer}
    .btn-small:hover{background:#f0f0f0}
    .toggle-folder{font-size:12px;color:#444;cursor:pointer}
    .folder-contents{margin-top:8px;padding-left:8px}
    .props{margin-top:10px;padding:8px;border:1px dashed #ddd;background:#fff;border-radius:6px}
    .props h4{margin:4px 0}
    label.small{font-size:12px;color:#444}
    .row{display:flex;gap:8px;align-items:center;margin:6px 0}
    .row input[type="color"]{width:38px;height:28px;padding:0;border:0}
    .row input[type="range"]{width:140px}
    .muted{font-size:12px;color:#666}
    .hidden{display:none}
    .symbol-select{padding:4px;font-size:12px}

    /* Layer Control Custom Style */
    .leaflet-control-layers {
      background: white;
      padding: 8px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    
    .leaflet-control-layers-toggle {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAApgAAAKYB3X3/OAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADCSURBVEiJ7ZUxDoJAEEXfQryBPQfwBNyAK3ABb2DN2lhZGaAyNlxBE2IhxkKSTQjBFWHBmP+3ySb/zWQ2MwvwJ5FUAugAXACuAHoADYBaUsN2UQDYAngD2AI4AWiBBYANgD2AvaSU7aICkDLzAuAJ4AxgKumB7aIAkDHzHMAFwAnAUdID20UFIGPmOYAzgAOAvaQbtovqV4C5/xfwnwDm/l/AfwKY+38B/wn4BfDbF/gF8NsX+AXw2xf4BfDbF/gF8NsX+AXwJ+ELhB5BlQrVvCQAAAAASUVORK5CYII=);
      width: 24px;
      height: 24px;
    }

    /* Modal PDF */
    .pdf-modal {
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .pdf-modal-content {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 450px;
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .pdf-modal-content h3 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    
    .pdf-modal-content input:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <h3>Mini MapGIS</h3>

      <div class="control-panel">
        <h3>Upload GPX File</h3>
        <input type="file" id="gpxFile" accept=".gpx" multiple>
         <hr>
        <button id="btnUpload">Upload</button>
        <div id="uploadProgress" style="display:none; margin-top:10px; color:#666;">
          Uploading: <span id="progressText">0/0</span> files...
        </div>
        <hr>
        <button id="btnPrintPdf" class="btn-small">Print Peta (PDF)</button>
      </div>

      <hr>

      <h4>Layer / File (Folder view)</h4>
      <div style="font-size:13px;color:#555;margin-bottom:6px">Klik nama untuk rename — Centang untuk tampil/hilang</div>
      <ul id="fileList"></ul>

      <div id="propertiesPanel" class="props hidden">
        <h4>Properti Layer</h4>
        <div id="propNameRow" class="row">
          <label class="small">Nama:</label>
          <input id="propName" type="text" style="flex:1;padding:6px" />
        </div>

        <div id="propStats" class="muted"></div>

        <hr>

        <div><label class="small">Style Editor</label></div>
        <div class="row">
          <label class="small">Stroke:</label>
          <input id="styleStrokeColor" type="color" />
          <label class="small">Width:</label>
          <input id="styleStrokeWidth" type="range" min="1" max="10" value="3" />
          <span id="strokeWidthVal" class="muted">3</span>
        </div>

        <div class="row">
          <label class="small">Fill:</label>
          <input id="styleFillColor" type="color" />
          <label class="small">Opacity:</label>
          <input id="styleFillOpacity" type="range" min="0" max="1" step="0.1" value="0.4" />
          <span id="fillOpacityVal" class="muted">0.4</span>
        </div>

        <div class="row">
          <label class="small">Line:</label>
          <select id="styleDash" class="symbol-select">
            <option value="">Solid</option>
            <option value="4,4">Dash</option>
            <option value="8,4,2,4">DashDot</option>
          </select>

          <label class="small">Marker:</label>
          <select id="styleMarker" class="symbol-select">
            <option value="circle">Circle</option>
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
            <option value="star">Star</option>
            <option value="pin">Pin</option>
          </select>
        </div>

        <!-- Tambahkan ini di index.html setelah baris tombol Reset, sebelum <hr> export buttons -->
        <hr>
        
        <div><label class="small">Label Editor</label></div>
        <div class="row">
          <label class="small">Tampilkan Label:</label>
          <input id="labelShow" type="checkbox" checked />
        </div>
        
        <div class="row">
          <label class="small">Warna Teks:</label>
          <input id="labelTextColor" type="color" value="#000000" />
          <label class="small">Ukuran:</label>
          <input id="labelTextSize" type="range" min="8" max="24" value="12" />
          <span id="labelSizeVal" class="muted">12</span>
        </div>
        
        <div class="row">
          <button id="resetLabelPosition" class="btn-small" style="width:100%">Reset Posisi Label</button>
        </div>
        
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="applyStyle" class="btn-small" style="flex:1; background:#4CAF50; color:white; border-color:#4CAF50; font-weight:600">Apply All Changes</button>
          <button id="revertStyle" class="btn-small" style="background:#ff6b6b; color:white; border-color:#ff6b6b">Reset All</button>
        </div>
        
        <hr>

        <hr>

        <div style="display:flex;gap:8px">
          <button id="exportGeojson" class="btn-small">Export GeoJSON</button>
          <button id="exportGpx" class="btn-small">Export GPX</button>
          <button id="exportKml" class="btn-small">Export KML</button>
          <button id="deleteLayer" class="btn-small" style="background:#fff1f1;border-color:#e88">Hapus Layer</button>
        </div>

      </div>

      <hr>
      <div class="muted" style="font-size:12px">Gunakan toolbar di peta untuk mengedit geometri. Rename & style langsung tersimpan ke metadata.</div>

    </div>

    <div id="map"></div>
  </div>

  <!-- Modal untuk Print PDF -->
  <div id="pdfModal" class="pdf-modal" style="display:none">
    <div class="pdf-modal-content">
      <h3 style="margin-top:0">Pengaturan PDF</h3>
      
      <div style="margin:15px 0">
        <label style="display:block; margin-bottom:5px; font-weight:600">Judul Peta:</label>
        <input type="text" id="pdfTitle" value="PETA AREAL KEBUN" 
               style="width:100%; padding:8px; font-size:14px; border:1px solid #ccc; border-radius:4px">
      </div>
      
      <div style="margin:15px 0">
        <label style="display:block; margin-bottom:5px; font-weight:600">Subtitle:</label>
        <input type="text" id="pdfSubtitle" value="HASIL PENGOLAHAN GPX" 
               style="width:100%; padding:8px; font-size:14px; border:1px solid #ccc; border-radius:4px">
      </div>
      
      <div style="margin-top:20px; display:flex; gap:10px; justify-content:flex-end">
        <button id="btnCancelPdf" class="btn-small" style="padding:8px 20px; background:#f5f5f5">Batal</button>
        <button id="btnConfirmPdf" class="btn-small" style="padding:8px 20px; background:#4CAF50; color:white; border-color:#4CAF50">Cetak PDF</button>
      </div>
    </div>
  </div>

  <script src="appminmapGIS.js"></script>
</body>
</html>
